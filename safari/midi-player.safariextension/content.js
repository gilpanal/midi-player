var i,main=function(){var s,d=/^data:audio\/midi/i,n=/\.mid$/i,o=/\.midi$/i,a=/\.kar$/i,r=/\.rmi$/i,h=/\.mp3$/i,m=/\.wav$/i,g=/\.ogg$/i,l="audio/midi",p="audio/mpeg",f="audio/ogg",y="audio/wav";function Z(t,e){return!!(t&&t.attributes&&t.attributes[e])&&(""==(i=t.attributes[e].nodeValue)||"f"!=(i=i.toLowerCase())&&"false"!=i&&0!=i&&!!i);var i}function v(t,e){return t&&t.attributes&&t.attributes[e]?t.attributes[e].nodeValue:""}function S(t,e){var i=v(t,e);return i==parseInt(i)?i:0}function b(t,e){return t.match(d)||t.match(n)||t.match(o)||t.match(a)||t.match(r)||e==l}function t(n){var o,a,t=n.dom.parentNode;n.ctrl?((a=document.createElement("div")).style.display="inline-block",a.style.margin="0px",a.style.padding="0px",a.style.borderStyle="none",a.style.cursor="default",t.insertBefore(a,n.dom),o=new JZZ.gui.Player(a)):o=new JZZ.gui.Player,t.removeChild(n.dom),a=o.gui;var r=n.src;r.match(d)&&(r="data:audio/midi"),a.title="Loading "+r;var l=new XMLHttpRequest;l.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){for(var t=l.responseText,e="",i=0;i<t.length;i++)e+=String.fromCharCode(255&t.charCodeAt(i));try{o.load(new JZZ.MIDI.SMF(e)),a.title=r,o.loop(n.loop),n.auto&&o.play()}catch(t){console.log(t.message?t.message:t),a.title="Cannot load "+r}}else a.title="Cannot load "+r},l.overrideMimeType("text/plain; charset=x-user-defined"),l.open("GET",n.src,!0),l.send()}var e=function(){window.JZZ||(window.JZZ=_JZZ()),JZZ.synth&&JZZ.synth.OSC||_OSC(),JZZ.synth.OSC.register("Web Audio"),JZZ().openMidiOut(),JZZ.MIDI.SMF||_SMF(),JZZ.gui&&JZZ.gui.Player||_Player(),e=function(){}};for(function(){var t,e,i,n,o,a,r,l,d,c,u=[];for(t=document.getElementsByTagName("BGSOUND"),i=0;i<t.length;i++)o=v(e=t[i],"src"),"infinity"==(r=v(e,"loop")).toLowerCase()?r=-1:(r!=parseInt(r)||r<2)&&(r=0),b(o)&&u.push({dom:e,type:"bgsound",src:o,loop:r,auto:!0,ctrl:!1,h:0,w:0});for(t=document.getElementsByTagName("AUDIO"),i=0;i<t.length;i++){if(l=[],(e=t[i]).attributes&&e.attributes.src&&l.push([v(e,"src")]),e.children)for(n=0;n<e.children.length;n++)"SOURCE"==e.children[n].nodeName&&e.children[n].attributes&&l.push([v(e.children[n],"src"),v(e.children[n],"type")]);for(o=void 0,n=0;n<l.length;n++){if(b(l[n][0],l[n][1])){o=l[n][0];break}if(d=l[n][0],c=l[n][1],d.match(h)||d.match(m)||d.match(g)||c==p||c==y||c==f)break}o&&u.push({dom:e,type:"audio",src:o,loop:Z(e,"loop")?-1:0,auto:Z(e,"autoplay"),ctrl:Z(e,"controls"),h:e.clientHeight,w:e.clientWidth})}for(t=document.getElementsByTagName("EMBED"),i=0;i<t.length;i++)b(o=v(e=t[i],"src"),o?v(e.children[n],"type"):void 0)&&(a=S(e,"height"),r=S(e,"width"),u.push({dom:e,type:"embed",src:o,loop:0,auto:Z(e,"autostart")||Z(e,"autoplay"),h:a,w:r,ctrl:!0}));for(t=document.getElementsByTagName("OBJECT"),i=0;i<t.length;i++)if(b(o=v(e=t[i],"data"),o?v(e.children[n],"type"):void 0)&&(a=S(e,"height"),r=S(e,"width"),u.push({dom:e,type:"object",src:o,loop:0,auto:!1,h:a,w:r,ctrl:!0}),e.children))for(n=0;n<e.children.length;n++)"PARAM"==e.children[n].nodeName&&e.children[n].attributes&&("loop"==v(e.children[n],"name")&&(u[u.length-1].loop=v(e.children[n],"value")||0),"autoplay"==v(e.children[n],"name")&&(u[u.length-1].auto=Z(e.children[n],"value")),"autostart"==v(e.children[n],"name")&&(u[u.length-1].auto=Z(e.children[n],"value")));s=u}(),s.length&&e(),i=0;i<s.length;i++)t(s[i]);s=[]};if(document instanceof HTMLDocument){var code=main.toString();code="("+code.substring(0,code.lastIndexOf("}"))+_JZZ.toString()+_OSC.toString()+_SMF.toString()+_OSC.toString()+_Player.toString()+"})()";var script=document.createElement("script");script.textContent=code,document.documentElement.appendChild(script)}